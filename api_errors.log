[2025-12-23T06:47:45.351098Z] Unhandled error at /api/v1/handle: '_name'
Traceback (most recent call last):
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\api\server.py", line 71, in handle_request
    router = get_router()
             ^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\api\server.py", line 18, in get_router
    router = RequestRouter()
             ^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\agent\router.py", line 22, in __init__
    self.tools = build_agent_tools() + [self._build_workflow_tool()]
                 ^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\tools\registry.py", line 245, in build_agent_tools
    tools.append(lc_tool(name)(_tool_impl))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\tools\convert.py", line 176, in _make_tool
    return StructuredTool.from_function(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\tools\structured.py", line 163, in from_function
    args_schema = create_schema_from_function(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\tools\base.py", line 218, in create_schema_from_function
    valid_properties = _get_filtered_args(
                       ^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\tools\base.py", line 97, in _get_filtered_args
    return {
           ^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\tools\base.py", line 98, in <dictcomp>
    k: schema[k]
       ~~~~~~^^^
KeyError: '_name'

[2025-12-23T06:51:31.740278Z] Unhandled error at /api/v1/handle: tool() got an unexpected keyword argument 'description'
Traceback (most recent call last):
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\api\server.py", line 71, in handle_request
    router = get_router()
             ^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\api\server.py", line 18, in get_router
    router = RequestRouter()
             ^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\agent\router.py", line 22, in __init__
    self.tools = build_agent_tools() + [self._build_workflow_tool()]
                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\agent\router.py", line 68, in _build_workflow_tool
    @lc_tool(
     ^^^^^^^^
TypeError: tool() got an unexpected keyword argument 'description'

[2025-12-23T06:54:25.993584Z] Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-IHe16***************************************FBKQ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}
Traceback (most recent call last):
  File "F:\workspace\nlp-crop-calendar\src\api\server.py", line 73, in handle_request
    return router.handle(request)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\agent\router.py", line 30, in handle
    result = self.agent.invoke({"input": request.prompt})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain\chains\base.py", line 166, in invoke
    raise e
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain\chains\base.py", line 156, in invoke
    self._call(inputs, run_manager=run_manager)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain\agents\agent.py", line 1636, in _call
    next_step_output = self._take_next_step(
                       ^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain\agents\agent.py", line 1342, in _take_next_step
    [
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain\agents\agent.py", line 1342, in <listcomp>
    [
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain\agents\agent.py", line 1370, in _iter_next_step
    output = self.agent.plan(
             ^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain\agents\agent.py", line 580, in plan
    for chunk in self.runnable.stream(inputs, config={"callbacks": callbacks}):
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\runnables\base.py", line 3262, in stream
    yield from self.transform(iter([input]), config, **kwargs)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\runnables\base.py", line 3249, in transform
    yield from self._transform_stream_with_config(
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\runnables\base.py", line 2056, in _transform_stream_with_config
    chunk: Output = context.run(next, iterator)  # type: ignore
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\runnables\base.py", line 3212, in _transform
    yield from final_pipeline
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\runnables\base.py", line 1272, in transform
    for ichunk in input:
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\runnables\base.py", line 5300, in transform
    yield from self.bound.transform(
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\runnables\base.py", line 1290, in transform
    yield from self.stream(final, config, **kwargs)
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\language_models\chat_models.py", line 411, in stream
    raise e
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_core\language_models\chat_models.py", line 391, in stream
    for chunk in self._stream(messages, stop=stop, **kwargs):
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langchain_openai\chat_models\base.py", line 637, in _stream
    response = self.client.create(**payload)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1147, in create
    return self._post(
           ^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-IHe16***************************************FBKQ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}

[2026-01-06T08:59:53.953076Z] 'str' object has no attribute 'model_dump'
Traceback (most recent call last):
  File "F:\workspace\nlp-crop-calendar\src\api\server.py", line 79, in handle_request
    response = router.handle(request)
               ^^^^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\agent\router.py", line 70, in handle
    plan = self._run_crop_calendar_workflow(request.prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\agent\router.py", line 164, in _run_crop_calendar_workflow
    return self._run_graph(prompt, self.crop_graph, self.CROP_WORKFLOW_TOOL)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\agent\router.py", line 183, in _run_graph
    state = graph.invoke(initial_state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langgraph\pregel\__init__.py", line 2894, in invoke
    for chunk in self.stream(
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langgraph\pregel\__init__.py", line 2527, in stream
    for _ in runner.tick(
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langgraph\pregel\runner.py", line 157, in tick
    run_with_retry(
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langgraph\pregel\retry.py", line 40, in run_with_retry
    return task.proc.invoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langgraph\utils\runnable.py", line 623, in invoke
    input = context.run(step.invoke, input, config, **kwargs)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\software\miniforge3\envs\llm-agent\Lib\site-packages\langgraph\utils\runnable.py", line 377, in invoke
    ret = self.func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\agent\workflows\crop_graph.py", line 158, in _extract_node
    draft = merge_planting_answers(prior_draft, answers=answers)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\workspace\nlp-crop-calendar\src\domain\services.py", line 85, in merge_planting_answers
    data = draft.model_dump()
           ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'model_dump'
During task with name 'extract' and id 'd4eaa6b1-0ef9-dc51-3621-db368923a1df'

